### 3.4 영속성 컨텍스트의 특징
- 특징
  - 영속성 컨텍스트와 식별자 값
    - 영속성 상태는 식별자 값(@Id)이 반드시 있어야 함
  - 영속성 컨텍스트와 데이터베이스 저장
    - 언제 데이터베이스에 저장? 보통 트랜잭셕 커밋 시 flush호출
  - 장점
    - 1차 캐시
    - 동일성 보장
    - 트랜잭션을 지원하는 쓰기 지연
    - 변경 감지
    - 지연 로딩
- 3.4.1 엔티티 조회
  - 1차 캐쉬에 MAP으로 저장 <Id, Entity>
  - 조회시 1차 캐쉬에서 조회
  - 존재하지 않으면, 데이터베이스에서 조회 한 후, 1차 캐쉬에 저장
  - 동일성 보장
- 3.4.2 엔티티 등록
  - persist시 1차 캐쉬에 등록 후, 내부 퀴리 저장소에 INSERT SQL을 모아둠
  - 트랜잭션 커밋 시, SQL 셋을 데이터베이스에 보냄
  - 쓰기 지연(transactional write-behind)
- 3.4.3 엔티티 수정
  - 매번 수정 쿼리를 작성하기란 쉽지 않음
  - JPA는 단순히 엔티티를 조회해서 데이터만 변경하면 됨
    - 변경 감지 (dirty checking)
    - 스냅샷 (엔티티의 최초 상태 in persistence context)
      - transaction commit
      - flush
      - dirty checking
      - create update query and save in SQL repository
      - send SQL to DB
      - DB transaction commit
    - JPA의 기본적략은 모든 필드 업데이트
      - 컬럼이 30개 이상이면, @DynamicUpdate 사용 추천
- 3.4.4 엔티티 삭제
